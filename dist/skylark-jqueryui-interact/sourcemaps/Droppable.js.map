{"version":3,"sources":["Droppable.js"],"names":["define","langx","eventer","noder","$","plugins","JqPlugin","patch","ddmanager","Droppable","inherit","klassName","pluginName","widgetEventPrefix","options","accept","addClasses","greedy","scope","tolerance","activate","deactivate","drop","out","over","_create","proportions","o","this","isover","isout","isFunction","d","is","arguments","length","width","element","offsetWidth","height","offsetHeight","_addToManager","_addClass","droppables","push","_splice","i","splice","_destroy","_setOption","key","value","_super","_activate","event","draggable","current","_addActiveClass","_trigger","ui","_deactivate","_removeActiveClass","_over","currentItem","call","_addHoverClass","_out","_removeHoverClass","_drop","custom","childrenIntersection","find","not","each","inst","droppable","disabled","intersect","extend","offset","c","helper","position","positionAbs","_removeClass","register"],"mappings":"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","file":"../Droppable.js","sourcesContent":["define( [\r\n\t\"skylark-langx/langx\",\r\n\t\"skylark-domx-eventer\",\r\n\t\"skylark-domx-noder\",\r\n\t\"skylark-domx-query\",\r\n\t\"skylark-domx-plugins-base\",\r\n\t\"skylark-jquery/jquery-plugin\",\r\n\t\"./patch\",\r\n\t\"./ddmanager\",\r\n],function(langx, eventer, noder, $, plugins, JqPlugin, patch, ddmanager) {\r\n\r\n\tvar Droppable = JqPlugin.inherit({\r\n\t\tklassName: \"Droppable\",\r\n\r\n\t\tpluginName : \"ui.Droppable\",\r\n\r\n\t\twidgetEventPrefix: \"drop\",\r\n\t\t\r\n\t\toptions: {\r\n\t\t\taccept: \"*\",\r\n\t\t\taddClasses: true,\r\n\t\t\tgreedy: false,\r\n\t\t\tscope: \"default\",\r\n\t\t\ttolerance: \"intersect\",\r\n\r\n\t\t\t// Callbacks\r\n\t\t\tactivate: null,\r\n\t\t\tdeactivate: null,\r\n\t\t\tdrop: null,\r\n\t\t\tout: null,\r\n\t\t\tover: null\r\n\t\t},\r\n\t\t_create: function() {\r\n\r\n\t\t\tvar proportions,\r\n\t\t\t\to = this.options,\r\n\t\t\t\taccept = o.accept;\r\n\r\n\t\t\tthis.isover = false;\r\n\t\t\tthis.isout = true;\r\n\r\n\t\t\tthis.accept = langx.isFunction( accept ) ? accept : function( d ) {\r\n\t\t\t\treturn d.is( accept );\r\n\t\t\t};\r\n\r\n\t\t\tthis.proportions = function( /* valueToWrite */ ) {\r\n\t\t\t\tif ( arguments.length ) {\r\n\r\n\t\t\t\t\t// Store the droppable's proportions\r\n\t\t\t\t\tproportions = arguments[ 0 ];\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// Retrieve or derive the droppable's proportions\r\n\t\t\t\t\treturn proportions ?\r\n\t\t\t\t\t\tproportions :\r\n\t\t\t\t\t\tproportions = {\r\n\t\t\t\t\t\t\twidth: this.element[ 0 ].offsetWidth,\r\n\t\t\t\t\t\t\theight: this.element[ 0 ].offsetHeight\r\n\t\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tthis._addToManager( o.scope );\r\n\r\n\t\t\to.addClasses && this._addClass( \"ui-droppable\" );\r\n\r\n\t\t},\r\n\r\n\t\t_addToManager: function( scope ) {\r\n\r\n\t\t\t// Add the reference and positions to the manager\r\n\t\t\tddmanager.droppables[ scope ] = ddmanager.droppables[ scope ] || [];\r\n\t\t\tddmanager.droppables[ scope ].push( this );\r\n\t\t},\r\n\r\n\t\t_splice: function( drop ) {\r\n\t\t\tvar i = 0;\r\n\t\t\tfor ( ; i < drop.length; i++ ) {\r\n\t\t\t\tif ( drop[ i ] === this ) {\r\n\t\t\t\t\tdrop.splice( i, 1 );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_destroy: function() {\r\n\t\t\tvar drop = ddmanager.droppables[ this.options.scope ];\r\n\r\n\t\t\tthis._splice( drop );\r\n\t\t},\r\n\r\n\t\t_setOption: function( key, value ) {\r\n\r\n\t\t\tif ( key === \"accept\" ) {\r\n\t\t\t\tthis.accept = langx.isFunction( value ) ? value : function( d ) {\r\n\t\t\t\t\treturn d.is( value );\r\n\t\t\t\t};\r\n\t\t\t} else if ( key === \"scope\" ) {\r\n\t\t\t\tvar drop = ddmanager.droppables[ this.options.scope ];\r\n\r\n\t\t\t\tthis._splice( drop );\r\n\t\t\t\tthis._addToManager( value );\r\n\t\t\t}\r\n\r\n\t\t\tthis._super( key, value );\r\n\t\t},\r\n\r\n\t\t_activate: function( event ) {\r\n\t\t\tvar draggable = ddmanager.current;\r\n\r\n\t\t\tthis._addActiveClass();\r\n\t\t\tif ( draggable ) {\r\n\t\t\t\tthis._trigger( \"activate\", event, this.ui( draggable ) );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_deactivate: function( event ) {\r\n\t\t\tvar draggable = ddmanager.current;\r\n\r\n\t\t\tthis._removeActiveClass();\r\n\t\t\tif ( draggable ) {\r\n\t\t\t\tthis._trigger( \"deactivate\", event, this.ui( draggable ) );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_over: function( event ) {\r\n\r\n\t\t\tvar draggable = ddmanager.current;\r\n\r\n\t\t\t// Bail if draggable and droppable are same element\r\n\t\t\tif ( !draggable || ( draggable.currentItem ||\r\n\t\t\t\t\tdraggable.element )[ 0 ] === this.element[ 0 ] ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.accept.call( this.element[ 0 ], ( draggable.currentItem ||\r\n\t\t\t\t\tdraggable.element ) ) ) {\r\n\t\t\t\tthis._addHoverClass();\r\n\t\t\t\tthis._trigger( \"over\", event, this.ui( draggable ) );\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t_out: function( event ) {\r\n\r\n\t\t\tvar draggable = ddmanager.current;\r\n\r\n\t\t\t// Bail if draggable and droppable are same element\r\n\t\t\tif ( !draggable || ( draggable.currentItem ||\r\n\t\t\t\t\tdraggable.element )[ 0 ] === this.element[ 0 ] ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.accept.call( this.element[ 0 ], ( draggable.currentItem ||\r\n\t\t\t\t\tdraggable.element ) ) ) {\r\n\t\t\t\tthis._removeHoverClass();\r\n\t\t\t\tthis._trigger( \"out\", event, this.ui( draggable ) );\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t_drop: function( event, custom ) {\r\n\r\n\t\t\tvar draggable = custom || ddmanager.current,\r\n\t\t\t\tchildrenIntersection = false;\r\n\r\n\t\t\t// Bail if draggable and droppable are same element\r\n\t\t\tif ( !draggable || ( draggable.currentItem ||\r\n\t\t\t\t\tdraggable.element )[ 0 ] === this.element[ 0 ] ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tthis.element\r\n\t\t\t\t.find( \":data(ui-droppable)\" )\r\n\t\t\t\t.not( \".ui-draggable-dragging\" )\r\n\t\t\t\t.each( function() {\r\n\t\t\t\t\tvar inst = $( this ).droppable( \"instance\" );\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tinst.options.greedy &&\r\n\t\t\t\t\t\t!inst.options.disabled &&\r\n\t\t\t\t\t\tinst.options.scope === draggable.options.scope &&\r\n\t\t\t\t\t\tinst.accept.call(\r\n\t\t\t\t\t\t\tinst.element[ 0 ], ( draggable.currentItem || draggable.element )\r\n\t\t\t\t\t\t) &&\r\n\t\t\t\t\t\tddmanager.intersect(\r\n\t\t\t\t\t\t\tdraggable,\r\n\t\t\t\t\t\t\tlangx.extend( inst, { offset: inst.element.offset() } ),\r\n\t\t\t\t\t\t\tinst.options.tolerance, event\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tchildrenIntersection = true;\r\n\t\t\t\t\t\treturn false; }\r\n\t\t\t\t} );\r\n\t\t\tif ( childrenIntersection ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.accept.call( this.element[ 0 ],\r\n\t\t\t\t\t( draggable.currentItem || draggable.element ) ) ) {\r\n\t\t\t\tthis._removeActiveClass();\r\n\t\t\t\tthis._removeHoverClass();\r\n\r\n\t\t\t\tthis._trigger( \"drop\", event, this.ui( draggable ) );\r\n\t\t\t\treturn this.element;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t},\r\n\r\n\t\tui: function( c ) {\r\n\t\t\treturn {\r\n\t\t\t\tdraggable: ( c.currentItem || c.element ),\r\n\t\t\t\thelper: c.helper,\r\n\t\t\t\tposition: c.position,\r\n\t\t\t\toffset: c.positionAbs\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t// Extension points just to make backcompat sane and avoid duplicating logic\r\n\t\t// TODO: Remove in 1.13 along with call to it below\r\n\t\t_addHoverClass: function() {\r\n\t\t\tthis._addClass( \"ui-droppable-hover\" );\r\n\t\t},\r\n\r\n\t\t_removeHoverClass: function() {\r\n\t\t\tthis._removeClass( \"ui-droppable-hover\" );\r\n\t\t},\r\n\r\n\t\t_addActiveClass: function() {\r\n\t\t\tthis._addClass( \"ui-droppable-active\" );\r\n\t\t},\r\n\r\n\t\t_removeActiveClass: function() {\r\n\t\t\tthis._removeClass( \"ui-droppable-active\" );\r\n\t\t}\r\n\t} );\r\n\r\n\tplugins.register(Droppable,\"droppable\");\r\n\r\n\treturn Droppable;\r\n\r\n});\r\n"]}