{"version":3,"sources":["Droppable.js"],"names":["define","langx","eventer","noder","$","plugins","JqPlugin","patch","ddmanager","Droppable","inherit","klassName","pluginName","widgetEventPrefix","options","accept","addClasses","greedy","scope","tolerance","activate","deactivate","drop","out","over","_create","proportions","o","this","isover","isout","isFunction","d","is","arguments","length","width","element","offsetWidth","height","offsetHeight","_addToManager","_addClass","droppables","push","_splice","i","splice","_destroy","_setOption","key","value","_super","_activate","event","draggable","current","_addActiveClass","_trigger","ui","_deactivate","_removeActiveClass","_over","currentItem","call","_addHoverClass","_out","_removeHoverClass","_drop","custom","childrenIntersection","find","not","each","inst","droppable","disabled","intersect","extend","offset","c","helper","position","positionAbs","_removeClass","register"],"mappings":"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","file":"../Droppable.js","sourcesContent":["define( [\n\t\"skylark-utils-dom/langx\",\n\t\"skylark-utils-dom/eventer\",\n\t\"skylark-utils-dom/noder\",\n\t\"skylark-utils-dom/query\",\n\t\"skylark-utils-dom/plugins\",\n\t\"./JqueryPlugin\",\n\t\"./patch\",\n\t\"./ddmanager\",\n],function(langx, eventer, noder, $, plugins, JqPlugin, patch, ddmanager) {\n\n\tvar Droppable = JqPlugin.inherit({\n\t\tklassName: \"Droppable\",\n\n\t\tpluginName : \"ui.Droppable\",\n\n\t\twidgetEventPrefix: \"drop\",\n\t\t\n\t\toptions: {\n\t\t\taccept: \"*\",\n\t\t\taddClasses: true,\n\t\t\tgreedy: false,\n\t\t\tscope: \"default\",\n\t\t\ttolerance: \"intersect\",\n\n\t\t\t// Callbacks\n\t\t\tactivate: null,\n\t\t\tdeactivate: null,\n\t\t\tdrop: null,\n\t\t\tout: null,\n\t\t\tover: null\n\t\t},\n\t\t_create: function() {\n\n\t\t\tvar proportions,\n\t\t\t\to = this.options,\n\t\t\t\taccept = o.accept;\n\n\t\t\tthis.isover = false;\n\t\t\tthis.isout = true;\n\n\t\t\tthis.accept = langx.isFunction( accept ) ? accept : function( d ) {\n\t\t\t\treturn d.is( accept );\n\t\t\t};\n\n\t\t\tthis.proportions = function( /* valueToWrite */ ) {\n\t\t\t\tif ( arguments.length ) {\n\n\t\t\t\t\t// Store the droppable's proportions\n\t\t\t\t\tproportions = arguments[ 0 ];\n\t\t\t\t} else {\n\n\t\t\t\t\t// Retrieve or derive the droppable's proportions\n\t\t\t\t\treturn proportions ?\n\t\t\t\t\t\tproportions :\n\t\t\t\t\t\tproportions = {\n\t\t\t\t\t\t\twidth: this.element[ 0 ].offsetWidth,\n\t\t\t\t\t\t\theight: this.element[ 0 ].offsetHeight\n\t\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._addToManager( o.scope );\n\n\t\t\to.addClasses && this._addClass( \"ui-droppable\" );\n\n\t\t},\n\n\t\t_addToManager: function( scope ) {\n\n\t\t\t// Add the reference and positions to the manager\n\t\t\tddmanager.droppables[ scope ] = ddmanager.droppables[ scope ] || [];\n\t\t\tddmanager.droppables[ scope ].push( this );\n\t\t},\n\n\t\t_splice: function( drop ) {\n\t\t\tvar i = 0;\n\t\t\tfor ( ; i < drop.length; i++ ) {\n\t\t\t\tif ( drop[ i ] === this ) {\n\t\t\t\t\tdrop.splice( i, 1 );\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t_destroy: function() {\n\t\t\tvar drop = ddmanager.droppables[ this.options.scope ];\n\n\t\t\tthis._splice( drop );\n\t\t},\n\n\t\t_setOption: function( key, value ) {\n\n\t\t\tif ( key === \"accept\" ) {\n\t\t\t\tthis.accept = langx.isFunction( value ) ? value : function( d ) {\n\t\t\t\t\treturn d.is( value );\n\t\t\t\t};\n\t\t\t} else if ( key === \"scope\" ) {\n\t\t\t\tvar drop = ddmanager.droppables[ this.options.scope ];\n\n\t\t\t\tthis._splice( drop );\n\t\t\t\tthis._addToManager( value );\n\t\t\t}\n\n\t\t\tthis._super( key, value );\n\t\t},\n\n\t\t_activate: function( event ) {\n\t\t\tvar draggable = ddmanager.current;\n\n\t\t\tthis._addActiveClass();\n\t\t\tif ( draggable ) {\n\t\t\t\tthis._trigger( \"activate\", event, this.ui( draggable ) );\n\t\t\t}\n\t\t},\n\n\t\t_deactivate: function( event ) {\n\t\t\tvar draggable = ddmanager.current;\n\n\t\t\tthis._removeActiveClass();\n\t\t\tif ( draggable ) {\n\t\t\t\tthis._trigger( \"deactivate\", event, this.ui( draggable ) );\n\t\t\t}\n\t\t},\n\n\t\t_over: function( event ) {\n\n\t\t\tvar draggable = ddmanager.current;\n\n\t\t\t// Bail if draggable and droppable are same element\n\t\t\tif ( !draggable || ( draggable.currentItem ||\n\t\t\t\t\tdraggable.element )[ 0 ] === this.element[ 0 ] ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( this.accept.call( this.element[ 0 ], ( draggable.currentItem ||\n\t\t\t\t\tdraggable.element ) ) ) {\n\t\t\t\tthis._addHoverClass();\n\t\t\t\tthis._trigger( \"over\", event, this.ui( draggable ) );\n\t\t\t}\n\n\t\t},\n\n\t\t_out: function( event ) {\n\n\t\t\tvar draggable = ddmanager.current;\n\n\t\t\t// Bail if draggable and droppable are same element\n\t\t\tif ( !draggable || ( draggable.currentItem ||\n\t\t\t\t\tdraggable.element )[ 0 ] === this.element[ 0 ] ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( this.accept.call( this.element[ 0 ], ( draggable.currentItem ||\n\t\t\t\t\tdraggable.element ) ) ) {\n\t\t\t\tthis._removeHoverClass();\n\t\t\t\tthis._trigger( \"out\", event, this.ui( draggable ) );\n\t\t\t}\n\n\t\t},\n\n\t\t_drop: function( event, custom ) {\n\n\t\t\tvar draggable = custom || ddmanager.current,\n\t\t\t\tchildrenIntersection = false;\n\n\t\t\t// Bail if draggable and droppable are same element\n\t\t\tif ( !draggable || ( draggable.currentItem ||\n\t\t\t\t\tdraggable.element )[ 0 ] === this.element[ 0 ] ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.element\n\t\t\t\t.find( \":data(ui-droppable)\" )\n\t\t\t\t.not( \".ui-draggable-dragging\" )\n\t\t\t\t.each( function() {\n\t\t\t\t\tvar inst = $( this ).droppable( \"instance\" );\n\t\t\t\t\tif (\n\t\t\t\t\t\tinst.options.greedy &&\n\t\t\t\t\t\t!inst.options.disabled &&\n\t\t\t\t\t\tinst.options.scope === draggable.options.scope &&\n\t\t\t\t\t\tinst.accept.call(\n\t\t\t\t\t\t\tinst.element[ 0 ], ( draggable.currentItem || draggable.element )\n\t\t\t\t\t\t) &&\n\t\t\t\t\t\tddmanager.intersect(\n\t\t\t\t\t\t\tdraggable,\n\t\t\t\t\t\t\tlangx.extend( inst, { offset: inst.element.offset() } ),\n\t\t\t\t\t\t\tinst.options.tolerance, event\n\t\t\t\t\t\t)\n\t\t\t\t\t) {\n\t\t\t\t\t\tchildrenIntersection = true;\n\t\t\t\t\t\treturn false; }\n\t\t\t\t} );\n\t\t\tif ( childrenIntersection ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif ( this.accept.call( this.element[ 0 ],\n\t\t\t\t\t( draggable.currentItem || draggable.element ) ) ) {\n\t\t\t\tthis._removeActiveClass();\n\t\t\t\tthis._removeHoverClass();\n\n\t\t\t\tthis._trigger( \"drop\", event, this.ui( draggable ) );\n\t\t\t\treturn this.element;\n\t\t\t}\n\n\t\t\treturn false;\n\n\t\t},\n\n\t\tui: function( c ) {\n\t\t\treturn {\n\t\t\t\tdraggable: ( c.currentItem || c.element ),\n\t\t\t\thelper: c.helper,\n\t\t\t\tposition: c.position,\n\t\t\t\toffset: c.positionAbs\n\t\t\t};\n\t\t},\n\n\t\t// Extension points just to make backcompat sane and avoid duplicating logic\n\t\t// TODO: Remove in 1.13 along with call to it below\n\t\t_addHoverClass: function() {\n\t\t\tthis._addClass( \"ui-droppable-hover\" );\n\t\t},\n\n\t\t_removeHoverClass: function() {\n\t\t\tthis._removeClass( \"ui-droppable-hover\" );\n\t\t},\n\n\t\t_addActiveClass: function() {\n\t\t\tthis._addClass( \"ui-droppable-active\" );\n\t\t},\n\n\t\t_removeActiveClass: function() {\n\t\t\tthis._removeClass( \"ui-droppable-active\" );\n\t\t}\n\t} );\n\n\tplugins.register(Droppable,\"droppable\");\n\n\treturn Droppable;\n\n});\n"]}