{"version":3,"sources":["Mouse.js"],"names":["define","browser","datax","$","plugins","JqPlugin","mouseHandled","document","on","MousePlugin","inherit","klassName","pluginName","options","cancel","distance","delay","_mouseInit","that","this","element","event","_mouseDown","data","target","removeData","stopImmediatePropagation","started","_mouseDestroy","off","_mouseMoveDelegate","_mouseUpDelegate","_mouseMoved","_mouseStarted","_mouseUp","_mouseDownEvent","btnIsLeft","which","elIsCancel","nodeName","closest","length","_mouseCapture","mouseDelayMet","_mouseDelayTimer","setTimeout","_mouseDistanceMet","_mouseDelayMet","_mouseStart","preventDefault","_mouseMove","ie","documentMode","button","originalEvent","altKey","ctrlKey","metaKey","shiftKey","ignoreMissingWhich","_mouseDrag","_mouseStop","clearTimeout","Math","max","abs","pageX","pageY","register"],"mappings":"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","file":"../Mouse.js","sourcesContent":["define( [\n\t\"skylark-utils-dom/browser\",\n\t\"skylark-utils-dom/datax\",\n\t\"skylark-utils-dom/query\",\n\t\"skylark-utils-dom/plugins\",\n\t\"./JqueryPlugin\",\n],function(browser, datax, $, plugins, JqPlugin) {\n\n\tvar mouseHandled = false;\n\t$( document ).on( \"mouseup\", function() {\n\t\tmouseHandled = false;\n\t} );\n\n\tvar MousePlugin = JqPlugin.inherit({\n\t\tklassName : \"MousePlugin\",\n\n\t\tpluginName : \"ui.mouse\",\n\n\t\toptions: {\n\t\t\tcancel: \"input, textarea, button, select, option\",\n\t\t\tdistance: 1,\n\t\t\tdelay: 0\n\t\t},\n\t\t_mouseInit: function() {\n\t\t\tvar that = this;\n\n\t\t\tthis.element\n\t\t\t\t.on( \"mousedown.\" + this.pluginName, function( event ) {\n\t\t\t\t\treturn that._mouseDown( event );\n\t\t\t\t} )\n\t\t\t\t.on( \"click.\" + this.pluginName, function( event ) {\n\t\t\t\t\tif ( true === datax.data( event.target, that.pluginName + \".preventClickEvent\" ) ) {\n\t\t\t\t\t\tdatax.removeData( event.target, that.pluginName + \".preventClickEvent\" );\n\t\t\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\tthis.started = false;\n\t\t},\n\n\t\t// TODO: make sure destroying one instance of mouse doesn't mess with\n\t\t// other instances of mouse\n\t\t_mouseDestroy: function() {\n\t\t\tthis.element.off( \".\" + this.pluginName );\n\t\t\tif ( this._mouseMoveDelegate ) {\n\t\t\t\tthis.document\n\t\t\t\t\t.off( \"mousemove.\" + this.pluginName, this._mouseMoveDelegate )\n\t\t\t\t\t.off( \"mouseup.\" + this.pluginName, this._mouseUpDelegate );\n\t\t\t}\n\t\t},\n\n\t\t_mouseDown: function( event ) {\n\n\t\t\t// don't let more than one widget handle mouseStart\n\t\t\tif ( mouseHandled ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._mouseMoved = false;\n\n\t\t\t// We may have missed mouseup (out of window)\n\t\t\t( this._mouseStarted && this._mouseUp( event ) );\n\n\t\t\tthis._mouseDownEvent = event;\n\n\t\t\tvar that = this,\n\t\t\t\tbtnIsLeft = ( event.which === 1 ),\n\n\t\t\t\t// event.target.nodeName works around a bug in IE 8 with\n\t\t\t\t// disabled inputs (#7620)\n\t\t\t\telIsCancel = ( typeof this.options.cancel === \"string\" && event.target.nodeName ?\n\t\t\t\t\t$( event.target ).closest( this.options.cancel ).length : false );\n\t\t\tif ( !btnIsLeft || elIsCancel || !this._mouseCapture( event ) ) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis.mouseDelayMet = !this.options.delay;\n\t\t\tif ( !this.mouseDelayMet ) {\n\t\t\t\tthis._mouseDelayTimer = setTimeout( function() {\n\t\t\t\t\tthat.mouseDelayMet = true;\n\t\t\t\t}, this.options.delay );\n\t\t\t}\n\n\t\t\tif ( this._mouseDistanceMet( event ) && this._mouseDelayMet( event ) ) {\n\t\t\t\tthis._mouseStarted = ( this._mouseStart( event ) !== false );\n\t\t\t\tif ( !this._mouseStarted ) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Click event may never have fired (Gecko & Opera)\n\t\t\tif ( true === datax.data( event.target, this.pluginName + \".preventClickEvent\" ) ) {\n\t\t\t\tdatax.removeData( event.target, this.pluginName + \".preventClickEvent\" );\n\t\t\t}\n\n\t\t\t// These delegates are required to keep context\n\t\t\tthis._mouseMoveDelegate = function( event ) {\n\t\t\t\treturn that._mouseMove( event );\n\t\t\t};\n\t\t\tthis._mouseUpDelegate = function( event ) {\n\t\t\t\treturn that._mouseUp( event );\n\t\t\t};\n\n\t\t\tthis.document\n\t\t\t\t.on( \"mousemove.\" + this.pluginName, this._mouseMoveDelegate )\n\t\t\t\t.on( \"mouseup.\" + this.pluginName, this._mouseUpDelegate );\n\n\t\t\tevent.preventDefault();\n\n\t\t\tmouseHandled = true;\n\t\t\treturn true;\n\t\t},\n\n\t\t_mouseMove: function( event ) {\n\n\t\t\t// Only check for mouseups outside the document if you've moved inside the document\n\t\t\t// at least once. This prevents the firing of mouseup in the case of IE<9, which will\n\t\t\t// fire a mousemove event if content is placed under the cursor. See #7778\n\t\t\t// Support: IE <9\n\t\t\tif ( this._mouseMoved ) {\n\n\t\t\t\t// IE mouseup check - mouseup happened when mouse was out of window\n\t\t\t\tif ( browser.ie && ( !document.documentMode || document.documentMode < 9 ) &&\n\t\t\t\t\t\t!event.button ) {\n\t\t\t\t\treturn this._mouseUp( event );\n\n\t\t\t\t// Iframe mouseup check - mouseup occurred in another document\n\t\t\t\t} else if ( !event.which ) {\n\n\t\t\t\t\t// Support: Safari <=8 - 9\n\t\t\t\t\t// Safari sets which to 0 if you press any of the following keys\n\t\t\t\t\t// during a drag (#14461)\n\t\t\t\t\tif ( event.originalEvent.altKey || event.originalEvent.ctrlKey ||\n\t\t\t\t\t\t\tevent.originalEvent.metaKey || event.originalEvent.shiftKey ) {\n\t\t\t\t\t\tthis.ignoreMissingWhich = true;\n\t\t\t\t\t} else if ( !this.ignoreMissingWhich ) {\n\t\t\t\t\t\treturn this._mouseUp( event );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( event.which || event.button ) {\n\t\t\t\tthis._mouseMoved = true;\n\t\t\t}\n\n\t\t\tif ( this._mouseStarted ) {\n\t\t\t\tthis._mouseDrag( event );\n\t\t\t\treturn event.preventDefault();\n\t\t\t}\n\n\t\t\tif ( this._mouseDistanceMet( event ) && this._mouseDelayMet( event ) ) {\n\t\t\t\tthis._mouseStarted =\n\t\t\t\t\t( this._mouseStart( this._mouseDownEvent, event ) !== false );\n\t\t\t\t( this._mouseStarted ? this._mouseDrag( event ) : this._mouseUp( event ) );\n\t\t\t}\n\n\t\t\treturn !this._mouseStarted;\n\t\t},\n\n\t\t_mouseUp: function( event ) {\n\t\t\tthis.document\n\t\t\t\t.off( \"mousemove.\" + this.pluginName, this._mouseMoveDelegate )\n\t\t\t\t.off( \"mouseup.\" + this.pluginName, this._mouseUpDelegate );\n\n\t\t\tif ( this._mouseStarted ) {\n\t\t\t\tthis._mouseStarted = false;\n\n\t\t\t\tif ( event.target === this._mouseDownEvent.target ) {\n\t\t\t\t\tdatax.data( event.target, this.pluginName + \".preventClickEvent\", true );\n\t\t\t\t}\n\n\t\t\t\tthis._mouseStop( event );\n\t\t\t}\n\n\t\t\tif ( this._mouseDelayTimer ) {\n\t\t\t\tclearTimeout( this._mouseDelayTimer );\n\t\t\t\tdelete this._mouseDelayTimer;\n\t\t\t}\n\n\t\t\tthis.ignoreMissingWhich = false;\n\t\t\tmouseHandled = false;\n\t\t\tevent.preventDefault();\n\t\t},\n\n\t\t_mouseDistanceMet: function( event ) {\n\t\t\treturn ( Math.max(\n\t\t\t\t\tMath.abs( this._mouseDownEvent.pageX - event.pageX ),\n\t\t\t\t\tMath.abs( this._mouseDownEvent.pageY - event.pageY )\n\t\t\t\t) >= this.options.distance\n\t\t\t);\n\t\t},\n\n\t\t_mouseDelayMet: function( /* event */ ) {\n\t\t\treturn this.mouseDelayMet;\n\t\t},\n\n\t\t// These are placeholder methods, to be overriden by extending plugin\n\t\t_mouseStart: function( /* event */ ) {},\n\t\t_mouseDrag: function( /* event */ ) {},\n\t\t_mouseStop: function( /* event */ ) {},\n\t\t_mouseCapture: function( /* event */ ) { return true; }\n\t});\n\n\n\tplugins.register(MousePlugin);\n\n\treturn MousePlugin;\n});\n"]}